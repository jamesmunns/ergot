# Week 1 Day 2

Notes doc for Week 1 Day 2 of "Working in Public" on ergot.

The meeting is at 10:30am CEST on YouTube.

* Link to livestream: <https://www.youtube.com/watch?v=PfSBvyHgYEM>
* Link to Matrix Chat: <https://matrix.to/#/#mnemos-dev:beeper.com>

Plan for today: Start capturing some of the intended use cases, what you can do,
what you can hopefully do soon.

## Feature Overview

### Connectivity - Now

Things you can do:

#### Direct connection, PC to 1x MCU

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  ┌────────────┐            ┌────────────┐ │
│ │            │            │   Micro    │
  │     PC     │◀──USB or──▶│ controller │ │
│ │            │    UART    │            │
  └────────────┘            └────────────┘ │
│  ┌─────────────────────┐
 ─ ┤  Direct Connection  ├ ─ ─ ─ ─ ─ ─ ─ ─ ┘
   └─────────────────────┘
```

#### Direct connection, 1:N

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  ┌────────────┐            ┌────────────┐ │
│ │            │◀──────────▶│   Micro    │
  │     PC     │◀────────┐  │ controller │ │
│ │            │◀─────┐  │  │            │
  └────────────┘      │  │  └────────────┘ │
│              USB or │  │  ┌────────────┐
                UARTs │  │  │   Micro    │ │
│                     │  └─▶│ controller │
                      │     │            │ │
│                     │     └────────────┘
                      │     ┌────────────┐ │
│                     │     │   Micro    │
                      └────▶│ controller │ │
│                           │            │
  ┌─────────────────────┐   └────────────┘ │
└ ┤   1:N Connections   ├ ─ ─ ─ ─ ─ ─ ─ ─ ─
  └─────────────────────┘
```

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  ┌────────────┐TCP Sockets ┌────────────┐ │
│ │   Server   │◀──────────▶│            │
  │  process   │◀────────┐  │  Process   │ │
│ │            │◀─────┐  │  │            │
  └────────────┘      │  │  └────────────┘ │
│                     │  │  ┌────────────┐
                      │  │  │            │ │
│                     │  └─▶│  Process   │
                      │     │            │ │
│                     │     └────────────┘
                      │     ┌────────────┐ │
│                     │     │            │
                      └────▶│  Process   │ │
│                           │            │
  ┌─────────────────────┐   └────────────┘ │
└ ┤   1:N Connections   ├ ─ ─ ─ ─ ─ ─ ─ ─ ─
  └─────────────────────┘
```

#### Direct connection, MCU to MCU

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  ┌────────────┐            ┌────────────┐ │
│ │   Micro    │            │   Micro    │
  │ Controller │◀───UART───▶│ controller │ │
│ │            │            │            │
  └────────────┘            └────────────┘ │
│  ┌─────────────────────┐
 ─ ┤  Direct Connection  ├ ─ ─ ─ ─ ─ ─ ─ ─ ┘
   └─────────────────────┘
```

### Connectivity - Soon

Things you can do soon(tm), and what is needed to make that happen:

#### Bridged connection, PC to Nx MCU to 1x MCU

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  ┌────────────┐            ┌────────────┐            ┌────────────┐           │
│ │            │            │   Micro    │            │   Micro    │
  │     PC     │◀──USB or──▶│ controller │◀──────────▶│ controller │─ ─ ─ ─ ─ ▶│
│ │            │    UART    │            │ UART, SPI, │            │(any depth)
  └────────────┘            └────────────┘   or I2C   └────────────┘           │
│  ┌─────────────────────┐
 ─ ┤ Bridged Connections ├ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘
   └─────────────────────┘
```

* Needs:
  * Concept of "Seed router"
  * Definition of "how a bridge can ask for network segment assignment"
  * How to maintain that connection
* Example of "broadcast bus"-style interfaces, e.g. RS-485, Radio
    * Needs: Some examples of how to handle things like addressing, physical
      addressing, likely bridged connection stuff too.
* Example of "time slice"-style interfaces, e.g. SPI, I2C
    * Needs: Similar to above

### Socket Features - Now

Things you can do:

#### Broadcast

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐
                                          ┌─────────┐
│                                   ┌────▶│STM32G030│ │
                                    │ ┌ ─▶└─────────┘
│                                   │                 │
  ┌────────┐         ┌────────┐     │ │   ┌─────────┐
│ │   PC   │◀───────▶│ RP2040 │◀────┼────▶│STM32G030│ │
  └────────┘◀ ─ ─ ─ ─└────────┘ ◀ ─ │ │┌ ▶└─────────┘
│                                  ││                 │
                                    │ │└ ─┌─────────┐
│                                  ││  ─ ─│STM32G030│ │
                                    └────▶└─────────┘
│ ┌─────────────────────┐          └ ─ ─ ─            │
 ─│Broadcast w/ Flooding│─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  └─────────────────────┘
```

#### Endpoint

```text
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  ┌────────────┐───Request─▶┌────────────┐ │
│ │            │◀─Response──│   Micro    │
  │     PC     │            │ controller │ │
│ │            │◀─Request───│            │
  └────────────┘──Response─▶└────────────┘ │
│  ┌─────────────────────┐
 ─ ┤    Endpoint/RPC     ├ ─ ─ ─ ─ ─ ─ ─ ─ ┘
   └─────────────────────┘
```

### Socket Features - Future

#### Sessionful Sockets

```
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐
  ┌────────────┐                       ┌────────────┐
│ │            │  ┌ ─ ─ ─ ─ ─ ─ ─ ─ ┐  │            │ │
  │            │◀──────────────────────│            │
│ │            │◀─┼─────────────────┼──│   Micro    │ │
  │     PC     │──────────────────────▶│ controller │
│ │            │◀─┼─────────────────┼──│            │ │
  │            │──────────────────────▶│            │
│ │            │  └ ─ ─ ─ ─ ─ ─ ─ ─ ┘  │            │ │
  └────────────┘                       └────────────┘
│ ┌──────────────────────┐                            │
 ─│Sessionful Connections├ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
  └──────────────────────┘
```

* Allows for:
    * Exclusive access to items
    * Keepalives, notice when device "drops"
    * Reliable deliver, retries, higher QoS
